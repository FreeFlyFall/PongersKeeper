<script>

  var target = 0; // add onchange listener
  var isP1 = true;
  var isP2 = false;
  
  var player1 = {
    score: 0,
    active: 0
  }
  var player2 = {
    score: 0,
    active: 0
  }
  
  var dbstat = {
    p1IsActive: 0,
    p2IsActive: 0
  }
  
  //window.addEventListener('load', (event) => {
  //  console.log('page is fully loaded');
  //});
  
  /// Initialization for each player based on visit order. Just handled with bool for now.
  google.script.run.withSuccessHandler(setupHandler).initialSetup(dbstat);
  function setupHandler(rdbstat){
      console.log("Initialize me, big boii.");
      if (rdbstat.p2IsActive == 1) {
        console.log("p2IsActive returned 1");
        isP2 = true;
        isP1 = false;
      } 
      else { console.log("isP1"); }
      console.log('Initialization complete.');
      console.log(rdbstat.p2IsActive);
      console.log("P1?: " + isP1 + ", P2?:" + isP2);
    }
    
  
  /// Score button listener
  document.getElementById("submit").addEventListener("click",function(){
    // Read db for p#active values in gs and return result for eval
    if (isP1 == true) {
      updateScore1();
    } else if (isP2 == true) {
      updateScore2();
    } else {
      console.log("error")
    }
  });
  
  /// Listener to update score in db and js for player 1, and update UI
  function updateScore1(player1){
    google.script.run 
          .withSuccessHandler(function(rPlayer1){
              player1.score = rPlayer1.score;
              console.log('Score1 updated to: ' + player1.score);
              player1.active = rPlayer1.active;
              console.log('p1Active = ' + player1.active);
              
              // update UI
          })
          .updateScore1(player1); 
  }
  
  /// Listener to update score in db and js for player 2, and update UI
  function updateScore2(player2){
      google.script.run // Run function from gs file
          .withSuccessHandler(function(rPlayer2){ 
              player2.score = rPlayer2.score;
              console.log('Score2 updated to: ' + player2.score);
              player2.active = rPlayer2.active;
              console.log('p2Active = ' + player2.active);
              
              // update UI
          })
          .updateScore2(player2);
  }
  
  /// OnChange listener to send target score to db, and update local vars/UI
  
  /// update tick /// still need to test timings
    // update js target score
    // update js score for opposing player
    
  /// Reset db on unload of either page
  
  </script>