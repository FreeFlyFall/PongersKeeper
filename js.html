<script>

  //Add boolean for whether the target shoudl be set, then invert it once ticked.
  var state = {
    p1score: 0,
    p2score: 0,
    isp1: 0,
    isp1: 0,
    target: 21,
    updateTarget: 0
  }
  
  //handle winning
  
  //window.addEventListener('load', (event) => {
  //  console.log('page is fully loaded');
  //});
  
  /// Initialization for each player based on visit order. Just handled with bool for now.
  google.script.run.withSuccessHandler(setupHandler).initialSetup(state);
  function setupHandler(rstate){
      console.log("Initialize me, big boii.");
      if (rstate.isp2 == 1) {
        state.isp2 = 1;
        console.log("p2");
      } 
      else if (rstate.isp1 == 1) {
        state.isp1 = 1;
        console.log("p1");
      }
    }
  
    
  /// Score button listener
  document.getElementById("submit").addEventListener("click",function(){
    // Read db for p#active values in gs and return result for eval
    if (state.isp1) {
      var currentp1score = document.getElementById("p1Display").textContent;
      console.log(currentp1score);
      state.p1score = currentp1score + 1;
      document.getElementById("p1Display").innerHTML = state.p1score;
    } else if (state.isp2) {
      var currentp2score = document.getElementById("p2Display").textContent;
      state.p2score = currentp2score + 1;
      document.getElementById("p2Display").innerHTML = state.p2score;
    } else {
      console.log("Error: Invalid session.");
    }
  });
  
  
  document.getElementById("target").addEventListener("change",function(e){
    state.target = e.target.value;
    state.updateTarget = 1;
  })
  
  
  //HANDLE VALIDATIONS
  /// update tick
  window.setInterval(function(){
    console.log("tick");
    console.log(state);
      // update js & ui target score
      google.script.run.withSuccessHandler(function(rstate){
        //console.log(state);
        state = rstate;
        if (state.isp1) {
          document.getElementById("p2Display").innerHTML = state.p2score;
          document.getElementById("target").innerHTML = state.target;
        } else if (state.isp2){
          document.getElementById("p1Display").innerHTML = state.p1score;
          document.getElementById("target").innerHTML = state.target;
        }
      }).updateState(state);
  }, 4000)
  
  
  
  /// Reset db on unload of either page
  window.addEventListener('beforeunload', function (e) {
    // the absence of a returnValue property on the event will guarantee the browser unload happens
    //if (state.isp1 == 1 || state.isp2 == 1){ // Might not be wanted since the db could become frozen if a browser is left open. Getting users could be used to fix this.
      google.script.run.resetDB();
      delete e['returnValue'];
    //}
  });
  
  //Tell the player which player they are //replace later with username from gscript
  
  </script>